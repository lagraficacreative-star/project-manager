<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaGr√†fica Projects | Workspace</title>

    <!-- Fonts: Outfit (Modern, Premium) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons: FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/modal.css">
</head>

<body class="theme-light">

    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar glass-panel">
            <div class="brand">
                <img src="assets/logo.png" alt="LaGr√†fica" style="height: 40px; width: auto;">
            </div>

            <nav class="nav-menu">
                <div class="nav-group">
                    <span class="nav-label">Principal</span>
                    <a href="#" class="nav-item active" onclick="App.navigate('dashboard')">
                        <i class="fa-solid fa-chart-pie"></i> Dashboard
                    </a>
                    <a href="#" class="nav-item" onclick="App.navigate('calendar')">
                        <i class="fa-solid fa-calendar-days"></i> Calendario
                    </a>
                    <a href="#" class="nav-item" onclick="App.navigate('mailbox')">
                        <i class="fa-solid fa-inbox"></i> Buz√≥n
                    </a>
                </div>

                <div class="nav-group">
                    <span class="nav-label">Proyectos</span>
                    <a href="#" class="nav-item nav-design" onclick="App.navigate('board', 'design')">
                        <i class="fa-solid fa-pen-nib"></i> Dise√±o
                    </a>
                    <a href="#" class="nav-item nav-social" onclick="App.navigate('board', 'social')">
                        <i class="fa-solid fa-hashtag"></i> Redes Sociales
                    </a>
                    <a href="#" class="nav-item nav-web" onclick="App.navigate('board', 'web')">
                        <i class="fa-solid fa-laptop-code"></i> Web
                    </a>
                    <a href="#" class="nav-item nav-kit" onclick="App.navigate('board', 'kit')">
                        <i class="fa-solid fa-bolt"></i> Kit Digital
                    </a>
                    <a href="#" class="nav-item" onclick="App.navigate('clients')">
                        <i class="fa-solid fa-tags"></i>
                        <span>Clientes</span>
                    </a>
                    <a href="#" class="nav-item nav-tenders" onclick="App.navigate('board', 'tenders')">
                        <i class="fa-solid fa-clipboard-list"></i>
                        <span>Licitaciones</span>
                    </a>
                </div>

                <div class="nav-group private">
                    <span class="nav-label"><i class="fa-solid fa-lock"></i> Gesti√≥n</span>
                    <a href="#" class="nav-item" onclick="App.navigate('board', 'budgets')">
                        <i class="fa-solid fa-file-invoice-dollar"></i> Presupuestos
                    </a>
                    <a href="#" class="nav-item" onclick="App.navigate('board', 'billing')">
                        <i class="fa-solid fa-receipt"></i> Facturaci√≥n
                    </a>
                </div>
            </nav>

            <div class="user-pill glass-panel">
                <div class="avatar">M</div>
                <div class="user-info">
                    <strong>Montse</strong>
                    <span>Director</span>
                </div>
            </div>
        </aside>

        <div id="notification-toast" class="notification-toast hidden">
            <div class="notif-icon"><i class="fa-solid fa-bell"></i></div>
            <div class="notif-content">
                <strong id="notif-title"></strong>
                <span id="notif-msg"></span>
            </div>
            <button class="notif-close" onclick="UI.hideNotification()"><i class="fa-solid fa-times"></i></button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar glass-panel">
                <div class="breadcrumbs">
                    <span id="page-title">Dashboard</span>
                </div>
                <div class="actions" id="top-actions">
                    <div id="team-top-container" class="team-top-row"></div>
                    <div class="search-box">
                        <i class="fa-solid fa-search"></i>
                        <input type="text" id="search-input" placeholder="Buscar proyecto...">
                    </div>
                    <button class="btn-icon" onclick="App.simulateEmail()" title="Simular entrada de Email"><i
                            class="fa-solid fa-envelope-open-text"></i></button>
                    <button class="btn-icon"><i class="fa-solid fa-bell"></i></button>
                    <button class="btn-primary" onclick="App.openModal('create-task')">
                        <i class="fa-solid fa-plus"></i> Nuevo
                    </button>
                </div>
            </header>

            <div id="view-container" class="view-container">
                <!-- Content injected here (Board, Dashboard, etc.) -->
                <div class="loading-spinner">Cargando...</div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <!-- New Task Modal -->
        <div id="modal-create-task" class="modal glass-panel hidden">
            <div class="modal-header">
                <h3>Nuevo Proyecto</h3>
                <button onclick="App.closeModal()"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="form-create-task" onsubmit="event.preventDefault(); return false;">
                    <!-- Header Fields -->
                    <div class="form-group">
                        <label>T√≠tulo</label>
                        <input type="text" name="title" required placeholder="Ej: Redise√±o Web..." class="input-lg">
                        <input type="hidden" name="attachments" id="input-attachments">
                    </div>

                    <!-- Single Row: Scope, Priority, Assignee, Client -->
                    <div class="form-row" style="display: flex; gap: 1rem; align-items: flex-end;">
                        <div class="form-group" style="flex: 1;">
                            <label>Tablero</label>
                            <select name="scope" style="width: 100%;">
                                <option value="design">Dise√±o</option>
                                <option value="social">Redes</option>
                                <option value="web">Web</option>
                                <option value="kit">Kit Digital</option>
                                <option value="tenders">Licitaciones</option>
                                <option value="budgets">Presupuestos</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Prioridad</label>
                            <select name="priority" style="width: 100%;">
                                <option value="high">Alta</option>
                                <option value="medium" selected>Media</option>
                                <option value="low">Baja</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Asignar a</label>
                            <select name="assignee" id="input-assignee" style="width: 100%;">
                                <option value="">Sin asignar</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1.5;">
                            <label>Cliente</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <select name="client" id="input-client" style="flex: 1;">
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                                <button type="button" onclick="App.navigate('clients')" title="Gestionar Clientes"
                                    style="background: white; border: 1px solid #d1d5db; border-radius: 0.5rem; width: 36px; color: #4b5563; cursor: pointer; flex-shrink: 0;">
                                    <i class="fa-solid fa-gear"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 1rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                            <label style="margin-bottom: 0;">Descripci√≥n / Contenido</label>
                            <button type="button" onclick="App.addExtraDescription()" title="A√±adir m√°s descripciones"
                                style="background: #f1f5f9; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer; color: var(--primary-color); font-size: 0.8rem;">
                                <i class="fa-solid fa-plus"></i> A√±adir Nota Extra
                            </button>
                        </div>
                        <textarea name="description" placeholder="Detalles del proyecto..."
                            style="width: 100%; min-height: 100px; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.75rem; font-family: inherit; font-size: 0.9rem;"></textarea>

                        <!-- Container for extra descriptions -->
                        <div id="extra-descriptions-container"
                            style="margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.5rem;"></div>
                    </div>

                    <div id="attachments-container" class="form-group hidden" style="margin-top: 1rem;">
                        <label><i class="fa-solid fa-paperclip"></i> Adjuntos</label>
                        <div id="task-attachments-list" class="attachment-chips" style="margin-top: 0.5rem;">
                            <!-- Adjuntos del mail inyectados aqu√≠ -->
                        </div>
                    </div>

                    <!-- Time & Date Row -->
                    <div class="form-row tracking-row">
                        <!-- Timer -->
                        <div class="form-group timer-box">
                            <label><i class="fa-regular fa-clock"></i> Control Horas</label>
                            <div class="timer-controls">
                                <div class="timer-display" id="timer-display">00:00:00</div>
                                <button type="button" id="btn-timer" class="btn-timer" onclick="App.toggleTimer()">
                                    <i class="fa-solid fa-play"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Calendar -->
                        <div class="form-group calendar-box">
                            <label><i class="fa-solid fa-calendar-days"></i> Entrega & GCalendar</label>
                            <div class="date-controls">
                                <input type="date" name="due_date" id="input-due-date">
                                <button type="button" class="btn-gcal" onclick="App.addToGoogleCalendar()"
                                    title="A√±adir a Google Calendar">
                                    <i class="fa-brands fa-google"></i>
                                </button>
                            </div>
                            <textarea name="calendar_notes" placeholder="Notas entrega..." rows="1"
                                style="margin-top:0.5rem; font-size:0.85rem;"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fa-brands fa-google-drive"></i> Link a Drive (Auto-generado)</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="url" name="drive_link" placeholder="Generando al guardar..."
                                        style="flex: 1;" readonly>
                                    <button type="button"
                                        onclick="window.open(document.getElementsByName('drive_link')[0].value, '_blank')"
                                        style="background: #E8F0FE; border: 1px solid #4285F4; border-radius: 0.5rem; width: 42px; color: #4285F4; cursor: pointer;"
                                        title="Abrir carpeta en Drive">
                                        <i class="fa-solid fa-external-link"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label><i class="fa-brands fa-dropbox"></i> Link a Dropbox</label>
                                <div class="input-icon">
                                    <input type="url" name="dropbox_link" placeholder="https://www.dropbox.com/...">
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="form-row split-sections">
                        <!-- Checklist -->
                        <div class="form-group half">
                            <label><i class="fa-solid fa-list-check"></i> Checklist</label>
                            <div class="checklist-container" id="checklist-items">
                                <!-- Items injected here -->
                            </div>
                            <div class="add-check-row">
                                <input type="text" id="new-check-input" placeholder="A√±adir √≠tem..."
                                    onkeypress="if(event.key === 'Enter') { event.preventDefault(); App.addCheckItem(this.value); this.value=''; }">
                                <button type="button"
                                    onclick="const i = document.getElementById('new-check-input'); App.addCheckItem(i.value); i.value='';"><i
                                        class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>

                        <!-- Attachments -->
                        <div class="form-group half">
                            <label><i class="fa-solid fa-paperclip"></i> Adjuntos</label>
                            <div class="attachments-list">
                                <div class="attachment-item upload-box">
                                    <i class="fa-solid fa-cloud-arrow-up"></i> Suelta archivos aqu√≠
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Protected Budget Section -->
                    <div class="form-section budget-section" id="budget-section"
                        style="display:none; border-color: var(--primary-color); background: #fff7ed;">
                        <div class="section-header"
                            style="display:flex; justify-content:space-between; align-items:center;">
                            <label style="color:#c2410c;"><i class="fa-solid fa-sack-dollar"></i> Datos
                                Econ√≥micos</label>
                            <span id="budget-status-badge" class="badge"
                                style="background:#fdba74; color:#9a3412; padding:2px 8px; border-radius:4px; font-size:0.7rem; display:none;">DESBLOQUEADO</span>
                        </div>

                        <!-- Locked State -->
                        <div id="budget-locked" class="locked-overlay"
                            style="text-align:center; padding:1.5rem; background: #fffbeb; border-radius: 8px;">
                            <p style="color:#92400e; margin-bottom:0.8rem; font-size:0.9rem; font-weight: 600;">üîê
                                Acceso Restringido</p>
                            <div style="display: flex; gap: 0.5rem; justify-content: center; align-items: center;">
                                <input type="password" id="budget-pin-input" placeholder="PIN" maxlength="4"
                                    style="width: 80px; text-align: center; padding: 0.5rem; border: 1px solid #d1d5db; background: white;"
                                    onkeypress="if(event.key === 'Enter') { event.preventDefault(); App.unlockBudget(); }">
                                <button type="button" class="btn-primary"
                                    style="background:#b45309; border:none; padding: 0.5rem 1rem;"
                                    onclick="App.unlockBudget()">
                                    <i class="fa-solid fa-unlock"></i>
                                </button>
                            </div>
                            <p id="budget-pin-error"
                                style="color: #ef4444; font-size: 0.75rem; margin-top: 0.5rem; display: none;">PIN
                                incorrecto</p>
                        </div>

                        <!-- Unlocked State -->
                        <div id="budget-unlocked" class="hidden" style="margin-top:1rem;">

                            <!-- Section 1: Client & Request -->
                            <div
                                style="background:#fff7ed; padding:10px; border-radius:6px; margin-bottom:1rem; border:1px solid #ffedd5;">
                                <div class="form-row">
                                    <div class="form-group" style="flex:2;">
                                        <label style="font-size:0.8rem; color:#9a3412;">Datos Fiscales Cliente</label>
                                        <input type="text" name="budget_client_info"
                                            placeholder="CIF, Raz√≥n Social, Direcci√≥n..." style="background:white;">
                                    </div>
                                    <div class="form-group" style="flex:1;">
                                        <label style="font-size:0.8rem; color:#9a3412;">Fecha Solicitud</label>
                                        <input type="date" name="budget_date" style="background:white;">
                                    </div>
                                </div>
                                <div class="form-row" style="margin-top:0.5rem;">
                                    <div class="form-group" style="flex:1; margin-bottom:0;">
                                        <label style="font-size:0.8rem; color:#9a3412;"><i
                                                class="fa-solid fa-file-pdf"></i>
                                            Archivo Presupuesto</label>
                                        <input type="file" name="budget_file" accept=".pdf,.doc,.docx"
                                            class="input-file-sm" style="background:white;">
                                    </div>
                                    <div class="form-group" style="flex:1; margin-bottom:0;">
                                        <label style="font-size:0.8rem; color:#9a3412;"><i
                                                class="fa-solid fa-file-invoice-dollar"></i>
                                            Link a Presupuesto</label>
                                        <input type="url" name="budget_link"
                                            placeholder="Enlace al presupuesto (Brouter, Excel...)"
                                            style="background:white; font-size: 0.8rem; padding: 0.5rem;">
                                    </div>
                                </div>
                            </div>

                            <!-- Section 2: Financials -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Importe Cliente (‚Ç¨)</label>
                                    <input type="number" name="budget_client" placeholder="0.00"
                                        oninput="App.calcProfit()">
                                </div>
                                <div class="form-group">
                                    <label>Gastos Proveedores (‚Ç¨)</label>
                                    <input type="number" name="budget_suppliers" placeholder="0.00"
                                        oninput="App.calcProfit()">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Coste Interno (‚Ç¨)</label>
                                    <input type="number" name="budget_cost" placeholder="0.00"
                                        oninput="App.calcProfit()">
                                </div>
                                <div class="form-group">
                                    <label>Beneficio Neto</label>
                                    <input type="text" id="budget-profit" readonly placeholder="-"
                                        style="background:#ecfdf5; color:#047857; font-weight:bold; cursor:not-allowed;">
                                </div>
                            </div>

                            <!-- Section 3: Notes -->
                            <div class="form-group" style="margin-top:0.5rem;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <label style="margin-bottom: 0; color:#9a3412;"><i
                                            class="fa-regular fa-comment-dots"></i>
                                        Notas Financieras /
                                        Comentarios</label>
                                    <button type="button" onclick="App.addExtraFinancialNote()"
                                        style="background: #ffedd5; border: none; width: 24px; height: 24px; border-radius: 4px; cursor: pointer; color: #b45309;">
                                        <i class="fa-solid fa-plus"></i>
                                    </button>
                                </div>
                                <textarea name="budget_notes" rows="2"
                                    placeholder="Condiciones de pago, notas internas..."></textarea>
                                <div id="extra-financial-notes-container"
                                    style="margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Timeline Section -->
                    <div class="form-section">
                        <label><i class="fa-solid fa-clock-rotate-left"></i> Historial</label>
                        <div id="task-timeline" class="timeline-box"
                            style="max-height:200px; overflow-y:auto; background:#f9fafb; border:1px solid #e5e7eb; border-radius:6px; padding:10px; margin-top:5px;">
                            <!-- Injected by JS -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="btn-delete-task" class="btn-danger hidden" onclick="App.deleteTask()"
                            style="background:none; border:none; color:#ef4444; margin-right: auto;"><i
                                class="fa-solid fa-trash"></i> Eliminar</button>
                        <button type="button" onclick="App.closeModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar Ficha</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- New Column Modal -->
        <div id="modal-create-column" class="modal glass-panel hidden" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Nueva Columna</h3>
                <button onclick="App.closeModal('create-column')"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="form-create-column" onsubmit="event.preventDefault(); App.submitNewColumn();">
                    <div class="form-group">
                        <label>Nombre de la Columna</label>
                        <input type="text" id="input-column-title" required placeholder="Ej: En Revisi√≥n"
                            class="input-lg">
                    </div>
                    <div class="form-actions">
                        <button type="button" onclick="App.closeModal('create-column')">Cancelar</button>
                        <button type="submit" class="btn-primary">Crear</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js?v=5"></script>
</body>

</html>